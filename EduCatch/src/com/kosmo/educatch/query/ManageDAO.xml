<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosmo.educatch.dao.ManageMapper">
	<!-- 학원회원 승인 탭 학원가입 회원 조회 -->
	<select id="getAcaAccept" parameterType="member" resultType="member">
		SELECT
				MNO, 
				MID, 
				ANAME, 
				MNAME, 
				ATEL, 
				MIMG, 
				TO_CHAR(MINSERTDATE,'YYYY-MM-DD') AS MINSERTDATE
		FROM
				(SELECT * FROM MEMBER A, ACADEMY B WHERE A.ACADEMY_ANO = B.ANO)
		WHERE MAUTH = 2
		AND MPERMISSION = 'N'
		AND ANO = #{ano}
	</select>
	<!-- 학원회원 승인 탭 승인 -->
	<update id="setAcceptAcaMem" parameterType="member">
		UPDATE 
				MEMBER
		SET 
				MPERMISSION = 'Y'
		WHERE
				MNO = #{mno}
	</update>
	<!-- 학원회원 승인 탭 승인거절 -->
	<delete id="delAcaMem" parameterType="member">
		DELETE FROM
				MEMBER
		WHERE
				MNO = #{mno}
	</delete>
	
	<select id="selectReservation" parameterType="member" resultType="timetable">
		SELECT  TTNO,
		        ACADEMY_ANO,
		        TO_CHAR(TTDATE, 'YYYY-MM-DD') AS TTDATE,
		        TTTIME,
		        TTPEOPLE
		FROM 	TIMETABLE
		WHERE 	ACADEMY_ANO = #{ano}
		AND 	TO_CHAR(TTDATE, 'YYYY-MM') = #{minsertdate}
	</select>
	
	<select id="selectMemList" parameterType="map" resultType="member">
		SELECT  MNO,
		        MNAME,
		        MTEL
		FROM 	(SELECT 
			            ROW_NUMBER() OVER(ORDER BY RENO) AS MNO, 
			            MNAME, 
			            MTEL 
			    FROM    RESERVATION A, 
			            MEMBER B,
			            TIMETABLE C
			    WHERE   A.MEMBER_MNO = B.MNO 
			    AND     A.TIME_TTNO = C.TTNO
			    AND     A.TIME_TTNO = #{ttno}
			    AND     C.ACADEMY_ANO = #{ano})
	</select>
	
	<insert id="insertTimetable" parameterType="timetable">
		<selectKey keyProperty="ttno" resultType="String" order="BEFORE">
	      SELECT    /*+ INDEX_DESC(SYS_C007117) */        
		          'TT'||LPAD(
		              (NVL(MAX(SUBSTR(TTNO,-4)),0)+1),5,'0' 
		          )TTNO
		  FROM TIMETABLE A
	    </selectKey>
	    
	    INSERT INTO TIMETABLE(
		                TTNO,
		                ACADEMY_ANO,
		                TTDATE,
		                TTTIME,
		                TTPEOPLE
		            )
		VALUES (
		            #{ttno},
		            #{academy_ano},
		            TO_DATE(#{ttdate},'YY/MM/DD'),
		            #{tttime},
		            #{ttpeople}
		)
	</insert>
	
	<update id="updateTimetable" parameterType="timetable">
		UPDATE  TIMETABLE
		SET     TTTIME = #{tttime},
		        TTPEOPLE = #{ttpeople}
		WHERE TTNO = #{ttno}
	</update>
	
	<delete id="deleteTimetable" parameterType="timetable">
		DELETE 
		FROM    TIMETABLE
		WHERE   TTNO = #{ttno}
	</delete>
	
	
	<!-- 학원관리 학원 조회 -->
	<select id="academyManageView" parameterType="academyview" resultType="academyview">
		
		SELECT
			    A.ANO,
			    A.ANAME,
			    A.ATEL,
			    A.AXPOINT,
			    A.AYPOINT,
			    A.AADDRNO,
			    A.AADDR1,
			    A.AADDR2,
			    A.ALOGO,
			    A.CATEGORY_CNO,
			    A.ADELETEYN,
			    TO_CHAR(A.AINSERTDATE,'YYYY-MM-DD') AS AINSERTDATE, 
			    TO_CHAR(A.AUPDATEDATE,'YYYY-MM-DD') AS AUPDATEDATE,
                B.MNO,
                B.ACADEMY_ANO
		FROM 
				ACADEMY A, MEMBER B
		WHERE A.ADELETEYN = 'N'
        AND A.ANO(+) = B.ACADEMY_ANO
        AND B.MNO = #{mno, jdbcType=VARCHAR}
		ORDER BY 1 DESC
	</select>
	
	<!-- 학원관리 과목 조회 -->
	<select id="subjectManageView" parameterType="subjectview" resultType="subjectview">
		
		SELECT
			    A.SNO,
			    A.SNAME,
			    A.SDAY,
			    A.STIME,
			    A.SPEOPLE,
			    A.SPRICE,
			    A.ACADEMY_ANO,
			    A.SDELETEYN,
			    TO_CHAR(A.SINSERTDATE,'YYYY-MM-DD') AS SINSERTDATE, 
			    TO_CHAR(A.SUPDATEDATE,'YYYY-MM-DD') AS SUPDATEDATE,
                B.ANO,
                B.ADELETEYN,
                TO_CHAR(B.AINSERTDATE,'YYYY-MM-DD') AS AINSERTDATE, 
			    TO_CHAR(B.AUPDATEDATE,'YYYY-MM-DD') AS AUPDATEDATE
		FROM 
				SUBJECT A , ACADEMY B, MEMBER C
		WHERE A.ACADEMY_ANO(+) = B.ANO
		AND A.SDELETEYN = 'N'
		AND B.ADELETEYN = 'N'
		AND C.MNO = #{mno, jdbcType=VARCHAR}
		ORDER BY 1 DESC
	</select>
	
	<!-- 학원관리 편의기능 조회 -->
	<select id="conManageView" parameterType="convenience" resultType="convenience">
		SELECT
			    A.ACADEMY_ANO,
                A.ACPARKING,
                A.ACSTORE,
                A.ACBUS,
                A.ACELEVATOR,
                A.ACSTUDYROOM,
                A.ACLOUNGE,
                A.ACLOCKER
		FROM 
				ACADEMY_CONVENIENCE A, MEMBER B
        WHERE A.ACADEMY_ANO(+) = B.ACADEMY_ANO
        AND B.MNO = #{mno, jdbcType=VARCHAR}
		ORDER BY 1 DESC
	</select>
	
	<!-- 학원관리 과목 삽입-->
	<insert id="insertSubject" parameterType="subjectview">
		<selectKey keyProperty="sno" resultType="String" order="BEFORE">
		SELECT 	/*+ INDEX_DESC(SYS_C0011497) */ 		 
			    'S'||LPAD(
			    (NVL(MAX(SUBSTR(A.SNO,-4)),0)+1),5,'0' 
			    )COMMNO  
		FROM SUBJECT A
		</selectKey>
		
		INSERT INTO SUBJECT
					(
					        SNO, 
						    SNAME,
						    SDAY,
						    STIME,
						    SPEOPLE,
						    SPRICE,
						    ACADEMY_ANO,
						    SDELETEYN,
						    SINSERTDATE,
						    SUPDATEDATE
					)
		VALUES
					(
					        #{sno, jdbcType=VARCHAR},
					        #{sname, jdbcType=VARCHAR},
					        #{sday, jdbcType=VARCHAR},
					        #{stime, jdbcType=VARCHAR},
					        #{speople, jdbcType=VARCHAR},
					        #{sprice, jdbcType=VARCHAR},
					        #{academy_ano, jdbcType=VARCHAR},
					        'N',
					        SYSDATE,
					        SYSDATE
					)
	</insert>
	<!-- 학원관리 학원 수정-->
	<update id="updateAcademy" parameterType="academyview">
		UPDATE ACADEMY
		    SET     ANAME = #{aname, jdbcType=VARCHAR},
		            ATEL = #{atel, jdbcType=VARCHAR},
		            AADDRNO = #{aaddrno, jdbcType=VARCHAR},
		            AADDR1 = #{aaddr1, jdbcType=VARCHAR},
		            AADDR2 = #{aaddr2, jdbcType=VARCHAR},
		            ALOGO = #{alogo, jdbcType=VARCHAR},
		            AUPDATEDATE = SYSDATE
		WHERE ADELETEYN = 'N'
		AND ANO= #{ano, jdbcType=VARCHAR}
	</update>	
	
	<!-- 학원관리 학원 수정-->
	<update id="updateAcademyNoImg" parameterType="academyview">
		UPDATE ACADEMY
		    SET     ANAME = #{aname, jdbcType=VARCHAR},
		            ATEL = #{atel, jdbcType=VARCHAR},
		            AADDRNO = #{aaddrno, jdbcType=VARCHAR},
		            AADDR1 = #{aaddr1, jdbcType=VARCHAR},
		            AADDR2 = #{aaddr2, jdbcType=VARCHAR},
		            AUPDATEDATE = SYSDATE
		WHERE ADELETEYN = 'N'
		AND ANO= #{ano, jdbcType=VARCHAR}
	</update>	
	
	<!-- 학원관리 편의기능 수정-->
	<update id="updateConvenience" parameterType="convenience">
		UPDATE  ACADEMY_CONVENIENCE
		    SET     ACPARKING = #{acparking, jdbcType=VARCHAR},
		            ACSTORE = #{acstore, jdbcType=VARCHAR},
		            ACBUS = #{acbus, jdbcType=VARCHAR},
		            ACELEVATOR = #{acelevator, jdbcType=VARCHAR},
		            ACSTUDYROOM = #{acstudyroom, jdbcType=VARCHAR},
		            ACLOUNGE = #{aclounge, jdbcType=VARCHAR},
		            ACLOCKER = #{aclocker, jdbcType=VARCHAR}
		WHERE ACADEMY_ANO= #{academy_ano, jdbcType=VARCHAR}
	</update>	
	
	<!-- 학원관리 과목선택 체크박스-->
	<select id="selectOneSubject" parameterType="String" resultType="subjectview">
		
		SELECT
			    A.SNO,
			    A.SNAME,
			    A.SDAY,
			    A.STIME,
			    A.SPEOPLE,
			    A.SPRICE,
			    A.ACADEMY_ANO,
			    A.SDELETEYN,
			    TO_CHAR(A.SINSERTDATE,'YYYY-MM-DD') AS SINSERTDATE, 
			    TO_CHAR(A.SUPDATEDATE,'YYYY-MM-DD') AS SUPDATEDATE
		FROM 
				SUBJECT A
        WHERE SNO=#{sno, jdbcType=VARCHAR}
	</select>
	
	<!-- 학원관리 과목수정-->
	<update id="updateSubject" parameterType="subjectview">
		UPDATE  SUBJECT
		    SET     SNAME = #{sname, jdbcType=VARCHAR},
		            SDAY = #{sday, jdbcType=VARCHAR},
		            STIME = #{stime, jdbcType=VARCHAR},
		            SPRICE = #{sprice, jdbcType=VARCHAR},
		            SPEOPLE = #{speople, jdbcType=VARCHAR},
		            SUPDATEDATE = SYSDATE
		WHERE SDELETEYN = 'N'
        AND SNO = #{sno, jdbcType=VARCHAR}
	</update>
	
	<!-- 학원관리 과목삭제-->
	<update id="deleteSubject" parameterType="subjectview">
		UPDATE  SUBJECT
		    SET     SDELETEYN='Y',
		    		SUPDATEDATE=SYSDATE
        WHERE SNO = #{sno, jdbcType=VARCHAR}
	</update>
	
	<!-- 학원관리 과목선택 체크박스-->
	<select id="selectOneConvenience" parameterType="String" resultType="convenience">
		SELECT
			    A.ACADEMY_ANO,
			    A.ACPARKING,
			    A.ACSTORE,
			    A.ACBUS,
			    A.ACELEVATOR,
			    A.ACSTUDYROOM,
			    A.ACLOUNGE,
			    A.ACLOCKER
		FROM 
				ACADEMY_CONVENIENCE A
        WHERE ACADEMY_ANO=#{academy_ano, jdbcType=VARCHAR}
	</select>
	
	
	
</mapper>
