<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
						
<mapper namespace = "com.kosmo.educatch.dao.ConsultMapper">
	<select id="listConsult" parameterType="consult" resultType="consult">
		SELECT
        A.CBNO                  AS CBNO,
        A.CBSUBJECT             AS CBSUBJECT,
        A.CBNAME                AS CBNAME,
        A.CBCONTENT             AS CBCONTENT,
        A.ACADEMY_ANO           AS ACADEMY_ANO,
        A.MEMBER_MNO            AS MEMBER_MNO,
        A.CDELETEYN             AS CDELETEYN,
        TO_CHAR(A.CINSERTDATE, 'YYYY-MM-DD')         AS CINSERTDATE,
        TO_CHAR(A.CUPDATEDATE, 'YYYY-MM-DD')         AS CUPDATEDATE
        FROM    CONSULTBOARD A
        WHERE   CDELETEYN = 'N'
        ORDER BY 1 DESC
	</select>
	<insert id="insertConsult" parameterType="consult">
		<selectKey keyProperty="cbno" resultType="String" order="BEFORE">
			SELECT 'C'||LPAD((SELECT /* +INDEX_DESC(A SYS_C0011684) */              
			NVL(MAX(SUBSTR(A.CBNO,-5)),0)+1 commNO
			FROM    CONSULTBOARD A), 5,'0') 
			FROM DUAL
		</selectKey>
			INSERT INTO CONSULTBOARD
			(
			    CBNO,
			    CBSUBJECT,
			    CBNAME,
			    CBCONTENT,
			    ACADEMY_ANO,
			    MEMBER_MNO,
			    CDELETEYN,
			    CINSERTDATE,
			    CUPDATEDATE
			)
			VALUES
			(
			#{cbno, jdbcType=VARCHAR},
			#{cbsubject, jdbcType=VARCHAR},
			#{cbname, jdbcType=VARCHAR},
			#{cbcontent, jdbcType=VARCHAR},
			#{academy_ano, jdbcType=VARCHAR},
			#{member_mno, jdbcType=VARCHAR},
			'N',
			SYSDATE, 
			SYSDATE
			)
	</insert>
</mapper>