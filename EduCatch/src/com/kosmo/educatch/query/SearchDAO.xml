<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosmo.educatch.dao.SearchMapper">

	<!-- 지역 대분류 -->
	<select id="getDistrict" parameterType="search" resultType="search">
	SELECT DISTINCT
	        A.DISTRICT   AS DISTRICT
	FROM    AREA A
	ORDER BY 1 DESC
	</select>
	
	<!-- 지역 소분류 -->
	<select id="getCity" parameterType="search" resultType="search">
	SELECT 
	        A.CITY       AS CITY
	FROM    AREA A
	WHERE	A.DISTRICT = #{district}
 	</select>
	
	<select id="getAcaList" parameterType="academyview" resultType="academyview">
SELECT 
    COUNT(C.ANO) OVER() AS LISTCOUNT
   ,C.ANO AS ANO
   ,C.ANAME AS ANAME
   ,C.ATEL AS ATEL
   ,C.AADDR1 AS AADDR1
   ,C.AADDR2 AS AADDR2
   ,C.ALOGO AS ALOGO
   ,C.AGRADE AS AGRADE
   ,D.CMAJOR AS CMAJOR
   ,D.CMINOR AS CMINOR
   ,C.AINSERTDATE AS AINSERTDATE
   ,C.AUPDATEDATE AS AUPDATEDATE
	FROM (SELECT    NVL(AVG(B.RBGRADE),0) AS AGRADE
	               ,A.CATEGORY_CNO AS CNO
	               ,A.ANO AS ANO
	               ,A.ANAME AS ANAME
	               ,A.ATEL AS ATEL
	               ,A.AADDR1 AS AADDR1
	               ,A.AADDR2 AS AADDR2
	               ,A.ALOGO AS ALOGO
	               ,TO_CHAR(AINSERTDATE,'YYYY-MM-DD') AS AINSERTDATE
	               ,TO_CHAR(AUPDATEDATE,'YYYY-MM-DD') AS AUPDATEDATE
	               ,COUNT(A.ANO) OVER() AS LISTCOUNT
	        FROM   ACADEMY A, REVIEWBOARD B
	        WHERE  B.ACADEMY_ANO(+) = A.ANO
	        AND    A.ADELETEYN = 'N'
	        GROUP BY A.CATEGORY_CNO,A.ANAME,A.ANO,A.ATEL,A.AADDR1,A.AADDR2,A.ALOGO,AINSERTDATE,AUPDATEDATE,TO_CHAR(AINSERTDATE,'YYYY-MM-DD') ,TO_CHAR(AUPDATEDATE,'YYYY-MM-DD')) C, 
	        CATEGORY D
	WHERE C.CNO = D.CNO
	<!-- 지역/카테고리 검색 -->
	<if test="district!=null or city!=null or cmajor!=null or cminor!=null">
    AND
    <![CDATA[ C.AADDR1 LIKE '%'||#{district}||'%' ]]>
	AND
	<![CDATA[ C.AADDR1 LIKE '%'||#{city}||'%' ]]>
	AND
	<![CDATA[ D.CMAJOR LIKE '%'||#{cmajor}||'%' ]]>
	<if test="!cminor.equals('전체')">
	AND
	<![CDATA[ D.CMINOR LIKE '%'||#{cminor}||'%' ]]>
	</if>
	</if>
	
	<!-- 학원명 검색 -->
	<if test="aname!=null">
	AND
	<![CDATA[ C.ANAME LIKE '%'||#{aname}||'%' ]]>
	</if>
	
	</select>
	
</mapper>
