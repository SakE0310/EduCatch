<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosmo.educatch.dao.SearchMapper">

	<!-- 지역 대분류 -->
	<select id="getDistrict" parameterType="search" resultType="search">
	SELECT DISTINCT
	        A.DISTRICT   AS DISTRICT
	FROM    AREA A
	ORDER BY 1 DESC
	</select>
	
	<!-- 지역 소분류 -->
	<select id="getCity" parameterType="search" resultType="search">
	SELECT 
	        A.CITY       AS CITY
	FROM    AREA A
	WHERE	A.DISTRICT = #{district}
 	</select>
	
	<select id="getAcaList" parameterType="academyview" resultType="academyview">
	SELECT 
         A.ANO AS ANO, 
         A.ANAME AS ANAME, 
         A.ATEL AS ATEL, 
         A.AXPOINT AS AXPOINT,
         A.AYPOINT AS AYPOINT,
         A.AADDRNO AS AADDRNO,
         A.AADDR1 AS AADDR1,
         A.AADDR2 AS AADDR2,
         A.ALOGO AS ALOGO,
         A.CATEGORY_CNO AS CATEGORY_CNO,
         A.ADELETEYN AS ADELETEYN,
         TO_CHAR(A.AINSERTDATE,'YYYY-MM-DD') AS AINSERTDATE, 
         TO_CHAR(A.AUPDATEDATE,'YYYY-MM-DD') AS AUPDATEDATE,
         B.CMAJOR AS CMAJOR,
         B.CMINOR AS CMINOR,
         COUNT(A.ANO) OVER() AS LISTCOUNT
    FROM   ACADEMY A, CATEGORY B
    WHERE  A.CATEGORY_CNO = B.CNO
    AND    A.ADELETEYN = 'N'
	<if test="district!=null or city!=null or cmajor!=null or cminor!=null">
    AND
    <![CDATA[ A.AADDR1 LIKE '%'||#{district}||'%' ]]>
	AND
	<![CDATA[ A.AADDR1 LIKE '%'||#{city}||'%' ]]>
	AND
	<![CDATA[ B.CMAJOR LIKE '%'||#{cmajor}||'%' ]]>
	<if test="!cminor.equals('전체')">
	AND
	<![CDATA[ B.CMINOR LIKE '%'||#{cminor}||'%' ]]>
	</if>
	AND
 	 	A.CATEGORY_CNO = B.CNO 
	</if>
	</select>
	
</mapper>
