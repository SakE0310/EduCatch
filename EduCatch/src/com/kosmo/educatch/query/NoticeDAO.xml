<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "com.kosmo.educatch.dao.NoticeMapper">

	<!-- 공지사항 전체조회 -->
	<select id="listNotice" parameterType="notice" resultType="notice">
	SELECT 
	        A.NNO                   AS NNO              					-- 공지사항 글번호
	        ,A.NSUBJECT             AS NSUBJECT        						-- 공지사항 제목
	        ,A.NNAME                AS NNAME            					-- 공지사항 작성자
	        ,A.NIMG                 AS NIMG             					-- 공자사항 이미지
	        ,A.NCONTENT             AS NCONTENT         					-- 공지사항 내용
	        ,A.NDELETEYN							AS NDELETEYN			-- 공지사항 삭제여부
		    ,TO_CHAR(A.NINSERTDATE,'YYYY-MM-DD')    AS NINSERTDATE			-- 공비사항 등록일자
	        ,TO_CHAR(A.NUPDATEDATE,'YYYY-MM-DD')          AS NUPDATEDATE    -- 공지사항 수정일자
	FROM
	        NOTICE A
	WHERE
	        A.NDELETEYN ='N'
	ORDER BY 1 DESC  
	</select>
	
	<!-- 공지사항 조회 -->
	<select id="selectNotice" parameterType="String" resultType="notice">
		SELECT
		        A.NNO                                   AS NNO
		        ,A.NSUBJECT                             AS NSUBJECT
		        ,A.NNAME                                AS NNAME
		        ,A.NIMG                                 AS NIMG
		        ,A.NCONTENT                             AS NCONTENT
		        ,A.NDELETEYN							AS NDELETEYN
		        ,TO_CHAR(A.NINSERTDATE,'YYYY-MM-DD')    AS NINSERTDATE
		        ,TO_CHAR(A.NUPDATEDATE,'YYYY-MM-DD')    AS NUPDATEDATE
		FROM
        		 NOTICE A
		WHERE
		        NDELETEYN='N'
		        AND NNO=#{nno, jdbcType=VARCHAR}
	</select>

	<!-- 공지사항 등록 -->
	<insert id="insertNotice" parameterType="notice">
	<selectKey keyProperty="nno" resultType="String" order="BEFORE">
	SELECT 	/*+ INDEX_DESC(SYS_C0011455) */ 		 
		    'N'||LPAD(
		    (NVL(MAX(SUBSTR(NNO,-4)),0)+1),5,'0' 
		    )COMMNO  
	FROM NOTICE A
	</selectKey>
	INSERT INTO NOTICE
					(
					         NNO                
					        ,NSUBJECT       
					        ,NNAME            
					        ,NIMG             
					        ,NCONTENT  
					        ,NDELETEYN
					        ,NINSERTDATE
					        ,NUPDATEDATE   
					)
	VALUES(
					         #{nno, jdbcType=VARCHAR}
					        ,#{nsubject, jdbcType=VARCHAR}             
					        ,'관리자'             
					        ,#{nimg, jdbcType=VARCHAR}             
					        ,#{ncontent, jdbcType=VARCHAR}             
					        ,'N'
					        ,SYSDATE
					        ,SYSDATE   
					)
	</insert>
	
	
	<!-- 공지사항 수정 -->
	<update id="updateNotice" parameterType="notice">
		UPDATE NOTICE
		SET 
			    NSUBJECT =  #{nsubject, jdbcType=VARCHAR}
			    ,NCONTENT = #{ncontent, jdbcType=VARCHAR} 
			    ,NIMG =#{nimg, jdbcType=VARCHAR} 
			    ,NUPDATEDATE=SYSDATE
			    
		WHERE
				 NNO=#{nno, jdbcType=VARCHAR}
	</update>
	
	
	<!-- 공지사항 삭제 -->
	<update id="deleteNotice" parameterType="notice">
	UPDATE NOTICE
	SET 
		     NDELETEYN='Y'
		    ,NUPDATEDATE=SYSDATE
	WHERE NNO=#{nno, jdbcType=VARCHAR}
	</update>
</mapper>

